!function($){"use strict";const page=WDS.page_name;function affiliate_page(){if("admin/affiliate"==page){var table=$("#table_primary"),datatable=$(table).DataTable({info:!1,order:[],pageLength:25});table_search_data(document.querySelector("#table_filter_search"),datatable),table_export_button(table,document.querySelector("#table_export_button"),"Affiliate "+WDS.blog_info),table_export_data(document.querySelectorAll("#table_export_menu [data-kt-export]"))}}function affiliate_payouts_page(){if("admin/affiliate-payouts"==page){var table1=$("#table_primary"),table2=$("#table_secondary"),datatable1=$(table1).DataTable({info:!1,order:[],pageLength:10}),datatable2=$(table2).DataTable({info:!1,order:[],pageLength:10});table_search_data(document.querySelector("#table_filter_search"),datatable1),table_search_data(document.querySelector("#table_filter_search2"),datatable2),document.querySelectorAll(".mark-paid-submit").forEach((function(btn){btn.addEventListener("click",(function(e){e.preventDefault(),disableButton(btn);var form=this.closest(".mark-paid-form"),formId=form.getAttribute("data-form-id"),amount=document.querySelector("#_amount"+formId).getAttribute("data-value"),method=document.querySelector("#_method"+formId).getAttribute("value"),account=document.querySelector("#_account"+formId).getAttribute("value"),formData=new FormData(form);formData.append("user_id",formId),formData.append("amount",amount),formData.append("method",method),formData.append("account",account),run_ajax("admin_payouts",formData,(function(response){const message=response.data&&response.data.message?response.data.message:response.data;response.success?run_ajax_success(message).then(result=>{if(result.isConfirmed){const redirectUrl=response.data.redirect;redirectUrl&&(location.href=redirectUrl)}}):run_ajax_error(message),resetButton(btn)}))}))}))}}function statistics_page(){if("admin/statistics"==page){var chart=null,element=document.getElementById("wds_charts"),height=parseInt(KTUtil.css(element,"height")),startDateDefault=moment().startOf("month"),endDateDefault=moment();$("#wds_daterangepicker").daterangepicker({startDate:startDateDefault,endDate:endDateDefault,ranges:{[WDS.time.all]:[moment(WDS.inv_date),moment()],[WDS.time.today]:[moment(),moment()],[WDS.time.yesterday]:[moment().subtract(1,"days"),moment().subtract(1,"days")],[WDS.time.last7d]:[moment().subtract(6,"days"),moment()],[WDS.time.last30d]:[moment().subtract(29,"days"),moment()],[WDS.time.tm]:[moment().startOf("month"),moment().endOf("month")],[WDS.time.lm]:[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],[WDS.time.ty]:[moment().startOf("year"),moment().endOf("year")],[WDS.time.ly]:[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")]},locale:{format:"D/M/YYYY"}},(function(start,end){getStats(start,end),getIncomes(start,end),getProducts(start,end),loadChartData(start,end),$(".statistic-date").text(start.format("D MMMM YYYY")+" - "+end.format("D MMMM YYYY")),showSpinner()})),getStats(startDateDefault,endDateDefault),getIncomes(startDateDefault,endDateDefault),getProducts(startDateDefault,endDateDefault),loadChartData(startDateDefault,endDateDefault);var options={series:[{name:WDS.leads,type:"bar",data:[0]},{name:WDS.sales,type:"bar",data:[0]},{name:WDS.conversion,type:"area",data:[0]}],chart:{fontFamily:"inherit",stacked:!1,height:height,toolbar:{show:!0,tools:{download:!0,selection:!1,zoom:!1,zoomin:!1,zoomout:!1,pan:!1,reset:!1}}},stroke:{curve:"smooth"},tooltip:{style:{fontSize:"12px"},y:{formatter:function(val,opts){return 2===opts.seriesIndex?val+"%":val}}},fill:{type:["gradient","gradient","solid"],opacity:.6,gradient:{shadeIntensity:1,inverseColors:!1,opacityFrom:.45,opacityTo:.05,stops:[20,100,100,100]}},yaxis:[{seriesName:WDS.leads,axisTicks:{show:!0},axisBorder:{show:!0},title:{text:""},min:0},{seriesName:WDS.sales,show:!1,min:0},{opposite:!0,seriesName:WDS.conversion,axisTicks:{show:!0},axisBorder:{show:!0},title:{text:""}}],plotOptions:{bar:{columnWidth:"20%"}}};(chart=new ApexCharts(element,options)).render()}function hideSpinner(){$(".spinner-border").addClass("d-none"),$(".w-statistic").removeClass("d-none"),$(".statistic-loader").addClass("d-none"),$(".statistic-loader-overlay").removeClass("overlay overlay-block")}function showSpinner(){$(".spinner-border").removeClass("d-none"),$(".w-statistic").addClass("d-none"),$(".statistic-loader").removeClass("d-none"),$(".statistic-loader-overlay").addClass("overlay overlay-block")}function ajaxHelper(name,startDate,endDate,callback){$.ajax({url:WDS.ajax_url,type:"POST",dataType:"json",data:{name:name,action:"run_wds",__nonce:WDS.ajax_nonce,start_date:startDate.format("YYYY-MM-DD"),end_date:endDate.format("YYYY-MM-DD")},success:callback,error:function(error){console.error("Error fetching data: ",error)}})}function getStats(startDate,endDate){ajaxHelper("admin_get_stats",startDate,endDate,(function(response){$("#w-leads").text(response.leads||0),$("#w-sales").text(response.sales||0),$("#w-conversion").text(response.conversion||"0%")}))}function getIncomes(startDate,endDate){ajaxHelper("admin_get_income",startDate,endDate,(function(response){$("#w-revenue").text(response.revenue||0),$("#w-profit").text(response.profit||0),$("#w-commission").text(response.commission||0)}))}function getProducts(startDate,endDate){ajaxHelper("admin_get_top_product",startDate,endDate,(function(response){var tbody=$("#productTable tbody");0===tbody.length?(tbody=$("<tbody></tbody>"),$("#productTable").append(tbody)):tbody.empty();for(var i=0;i<response.length;i++){var row=$('<tr><td class="ps-4"><span class="text-gray-700 fw-bold text-hover-primary d-block mb-1 fs-6">'+response[i].product_name+'</span></td><td><span class="text-gray-700 fw-bold text-hover-primary d-block mb-1 fs-6">'+response[i].sales+'</span></td><td><span class="text-gray-700 fw-bold text-hover-primary d-block mb-1 fs-6">'+response[i].revenue+'</span></td><td class="text-center"><a href="'+response[i].edit+'" target="_blank" class="btn btn-bg-light btn-color-muted btn-active-color-primary btn-sm px-4 me-2"> Edit </a></td></tr>');tbody.append(row)}}))}function updateChart(seriesData,categories,maxnumber){chart&&(chart.updateSeries(seriesData||[]),chart.updateOptions({xaxis:{categories:categories||[]}}))}function loadChartData(startDate,endDate){ajaxHelper("admin_get_stats_chart",startDate,endDate,(function(response){updateChart(response.series,response.xaxis.categories,response.maxnumber),hideSpinner()}))}}function users_page(){if("admin/users"==page){getStatistic();var table=document.querySelector("#table_primary"),datatable=$(table).DataTable({serverSide:!0,processing:!0,ajax:{url:WDS.ajax_url,type:"POST",data:function(d){return{...d,name:"admin_get_users",action:"run_wds",__nonce:WDS.ajax_nonce,status:$('select[name="status"]').val(),group:$('select[name="group"]').val(),expired:$('select[name="expired"]').val(),client_quota:$('select[name="client_quota"]').val(),invitation_quota:$('select[name="invitation_quota"]').val(),created:$('select[name="created"]').val(),storage:$('select[name="storage"]').val()}}},columns:[{data:"avatar",render:function(data,type,row){return`\n                \t<div class="d-flex align-items-center">\n                \t\t<div class="symbol symbol-circle symbol-50px overflow-hidden me-3">\n                \t\t\t<div class="symbol-label">\n                \t\t\t\t<a href="${row.edit_link}">\n                \t\t\t\t\t<img src="${row.spinner}" data-src="${data}" class="lozad w-100" />\n                \t\t\t\t</a>\n                \t\t\t</div>\n                \t\t</div>\n                \t\t<div class="d-flex flex-column">\n                \t\t\t<span class="text-gray-800">${row.name}</span>\n                \t\t\t<span>${row.email}</span>\n                \t\t\t<span>${row.phone}</span>\n                \t\t</div>\n                \t</div>`}},{data:"status"},{data:"user_group"},{data:"user_expired"},{data:"invitation_quota"},{data:"client_quota"},{data:"invitation_created"},{data:"storage"}],info:!1,order:[],pageLength:10,lengthMenu:[[10,25,50,100,250,-1],[10,25,50,100,250,"All"]],ordering:!1});datatable.on("draw",(function(){lozad().observe()})),table_search_data(document.querySelector("#table_filter_search"),datatable),table_export_button(table,document.querySelector("#table_export_button"),"User "+WDS.blog_info),table_export_data(document.querySelectorAll("#table_export_menu [data-kt-export]")),$("#btn-filter").on("click",(function(e){e.preventDefault(),datatable.draw()})),$("#btn-reset").on("click",(function(e){e.preventDefault(),$('select[name="status"], select[name="group"], select[name="expired"], select[name="invitation_quota"], select[name="client_quota"], select[name="created"], select[name="storage"]').val("").trigger("change"),datatable.draw()}))}function hideSpinner(){$(".spinner-border").addClass("d-none"),$(".w-statistic").removeClass("d-none")}function getStatistic(){$.ajax({url:WDS.ajax_url,type:"POST",dataType:"json",data:{name:"admin_get_user_statistic",action:"run_wds",__nonce:WDS.ajax_nonce},success:function(response){$("#w-user").text(response.user||0),$("#w-active").text(response.active||0),$("#w-trial").text(response.trial||0),$("#w-member").text(response.member||0),$("#w-reseller").text(response.reseller||0),hideSpinner()},error:function(error){console.error("Error fetching data: ",error)}})}}KTUtil.onDOMContentLoaded((function(){affiliate_page(),affiliate_payouts_page(),statistics_page(),users_page()}))}(jQuery);