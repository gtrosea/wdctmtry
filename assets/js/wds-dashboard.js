!function($){"use strict";const page=WDS.page_name;function invitation_page(){if("dashboard/invitation"==page){var layout=WDS.inv.layout,count="true"==WDS.inv.templates_count,form=document.querySelector("#invitation_form"),btn=document.querySelector("#invitation_submit"),fields={title:{validators:{notEmpty:{message:WDS.text.error.input_field}}},slug:{validators:{notEmpty:{message:WDS.text.error.input_field}}},template:{validators:{notEmpty:{message:WDS.text.error.input_field}}},price:{validators:{notEmpty:{message:WDS.text.error.input_field}}}},category;if(count&&(fields.category={validators:{notEmpty:{message:WDS.text.error.input_field}}}),form)var validator=initValidation(form,fields);if("grid"!=layout){var table=document.querySelector("#invitation_table"),tableSearch=document.querySelector("#table_invitation_search"),tableBtn=document.querySelector("#table_invitation_button"),tableExport=document.querySelectorAll("#table_invitation_menu [data-kt-export]");table.querySelectorAll("tbody tr").forEach(row=>{const dateRow=row.querySelectorAll("td"),realDate=moment(dateRow[3].innerHTML,"DD MMM YYYY, LT").format();dateRow[3].setAttribute("data-order",realDate)});var datatable=$(table).DataTable({responsive:!1,info:!1,order:[],pageLength:10,columnDefs:[{orderable:!1,targets:count?5:4}]});table_search_data(tableSearch,datatable),table_export_button(table,tableBtn,"Invitation "+WDS.blog_info,!1),table_export_data(tableExport)}if($("#select-category").length)$("#select-category").change((function(){var selected=$(this).val();$.ajax({url:WDS.ajax_url,type:"POST",data:{name:"invitation_terms_callback",action:"run_wds",__nonce:WDS.ajax_nonce,category:selected},success:function(response){$("#taxonomy").val(response.data.taxonomy),$("#template").html(response.data.template)}})}));btn&&btn.addEventListener("click",(function(e){e.preventDefault(),validator.validate().then((function(status){if("Valid"==status){disableButton(btn);var select=form.querySelector("#template"),selectedLabel=select.options[select.selectedIndex].text,formData=new FormData(form);formData.append("template_name",selectedLabel),run_ajax("invitation_add",formData,(function(response){const message=response.data&&response.data.message?response.data.message:response.data;response.success?(form.reset(),run_ajax_success(message).then(result=>{if(result.isConfirmed){const redirectUrl=response.data.redirect;redirectUrl&&(location.href=redirectUrl)}})):run_ajax_error(message),resetButton(btn)}))}else run_ajax_error(WDS.text.error.input)}))})),document.querySelectorAll('[data-wds-row="activate"]').forEach(button=>{button.addEventListener("click",(function(e){if(e.preventDefault(),"grid"==layout)var card=e.target.closest('[data-wds-row="invitation"]'),post_id=card.dataset.postId,post_title=card.dataset.postTitle;else var parent=e.target.closest("tr"),post_id=parent.querySelector('[data-wds-row="post_id"]').innerText,post_title=parent.querySelector('[data-wds-row="title"]').innerText;Swal.fire({html:WDS.inv.activate_text1+' <b>"'+post_title+'"</b>?',icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:WDS.inv.activate_text2,cancelButtonText:WDS.inv.activate_text3,customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then((function(result){result.value?$.ajax({url:WDS.ajax_url,type:"POST",data:{name:"invitation_activate",action:"run_wds",__nonce:WDS.ajax_nonce,post_id:post_id},success:function(response){const message=response.data&&response.data.message?response.data.message:response.data;response.success?run_ajax_success(message).then(result=>{if(result.isConfirmed){const redirectUrl=response.data.redirect;redirectUrl&&(location.href=redirectUrl)}}):run_ajax_error(message).then(result=>{result.isConfirmed&&(location.href=WDS.url.upgrade)})}}):"cancel"===result.dismiss&&run_ajax_error(WDS.inv.activate_text4)}))}))}),"grid"==layout&&document.querySelectorAll('[data-wds-row="extend"]').forEach(button=>{button.addEventListener("click",(function(e){e.preventDefault();const card=e.target.closest('[data-wds-row="invitation"]'),post_id=card.dataset.postId,post_title=card.dataset.postTitle;Swal.fire({html:WDS.inv.extend_text1+' <b>"'+post_title+'"</b>?',icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:WDS.inv.extend_text2,cancelButtonText:WDS.inv.extend_text3,customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then((function(result){result.value?$.ajax({url:WDS.ajax_url,type:"POST",data:{name:"invitation_extend",action:"run_wds",__nonce:WDS.ajax_nonce,post_id:post_id},success:function(response){const message=response.data&&response.data.message?response.data.message:response.data;response.success?run_ajax_success(message).then(result=>{if(result.isConfirmed){const redirectUrl=response.data.redirect;redirectUrl&&(location.href=redirectUrl)}}):run_ajax_error(message)}}):"cancel"===result.dismiss&&run_ajax_error(WDS.inv.extend_text4)}))}))})}}function invitation_create_page(){if("dashboard/invitation/create"==page){var urlParams=new URLSearchParams(window.location.search),category_id=urlParams.get("category")?urlParams.get("category"):"",categoryList=$("#category-list"),subcategoryList=$("#subcategory-list"),subthemeList=$("#subtheme-list");loadCategories(),loadSubcategories(category_id),loadThemes(category_id),loadSubtheme(category_id),handleBtnModal(),handleSubmit()}function loadCategories(){$.ajax({url:WDS.ajax_url,type:"POST",dataType:"json",data:{name:"invitation_get_category",action:"run_wds",__nonce:WDS.ajax_nonce},success:function(data){data?displayCategories(data):console.error("Error: Failed to retrieve category data.")},error:function(error){console.error("Error loading category data:",error)}})}function displayCategories(categories){categories.forEach((function(category,index){var activeClass=category.ID==category_id?" active":"",icon=category.icon?'<img src="'+category.icon+'" alt="'+category.name+'" class="img-fluid p-2" style="max-width: 50px; max-height: 50px;">':"",listItem=$('<li class="nav-item'+(index===categories.length-1?"":" me-3 me-lg-6")+'"><a href="#" class="nav-link d-flex justify-content-between flex-column flex-center overflow-hidden text-nowrap py-4'+activeClass+'" data-category-id="'+category.ID+'">'+icon+'<span class="nav-text text-gray-700 fw-bold fs-6 lh-1">'+category.name+'</span><span class="bullet-custom position-absolute bottom-0 w-100 h-4px bg-primary"></span></a></li>');listItem.find("a").on("click",(function(e){e.preventDefault();var clickedCategoryId=$(this).data("category-id"),activeSubcategory=$("#subcategory-list .nav-link.active").data("subcategory-id");$(this).hasClass("active")||(loadThemes(clickedCategoryId,activeSubcategory),loadSubcategories(clickedCategoryId),loadSubtheme(clickedCategoryId),$("#separator-subcategory").addClass("d-none"),$("#separator-subtheme").addClass("d-none")),listItem.siblings().find("a").removeClass("active"),$(this).addClass("active")})),categoryList.append(listItem)})),$(".ajaxListPlaceholder").addClass("d-none")}function loadSubcategories(category_id){$(".ajaxSubPlaceholder").removeClass("d-none"),subcategoryList.empty(),$.ajax({url:WDS.ajax_url,type:"POST",dataType:"json",data:{name:"invitation_get_subcategory",action:"run_wds",__nonce:WDS.ajax_nonce,category:category_id},success:function(data){data?displaySubcategories(data):console.error("Error: Failed to retrieve subcategory data.")},error:function(error){console.error("Error loading subcategory data:",error)}})}function displaySubcategories(subcategories){subcategories.length>0?($("#separator-subcategory").removeClass("d-none"),subcategories.forEach((function(category){var activeClass="all"==category.ex?" active":"",listItem=$('<li class="nav-item"><a href="#" class="nav-link btn btn-sm btn-color-muted btn-active btn-active-secondary fw-bold px-4 text-nowrap'+activeClass+'" data-subcategory-id="'+category.ID+'">'+category.name+"</span></a></li>");listItem.find("a").on("click",(function(e){e.preventDefault();var activeCategoryId=$("#category-list .nav-link.active").data("category-id"),clickedSubcategory=$(this).data("subcategory-id");$(this).hasClass("active")||(loadThemes(activeCategoryId,clickedSubcategory),loadSubtheme(activeCategoryId,clickedSubcategory),$("#separator-subtheme").addClass("d-none")),listItem.siblings().find("a").removeClass("active"),$(this).addClass("active")})),subcategoryList.append(listItem)})),$("#subcategory-list").removeClass("d-none"),$("#subtheme-list").removeClass("d-none")):$("#subcategory-list").addClass("d-none"),$(".ajaxSubPlaceholder").addClass("d-none")}function loadThemes(category_id,subcategory="",subtheme=""){$(".ajaxCardPlaceholder").removeClass("d-none"),$("#cardThemeContainer").empty(),$.ajax({url:WDS.ajax_url,type:"POST",dataType:"json",data:{name:"invitation_get_theme",action:"run_wds",__nonce:WDS.ajax_nonce,category:category_id,subcategory:subcategory,subtheme:subtheme},success:function(response){var dynamicContentContainer=$("#cardThemeContainer");if(response&&response.length>0)response.forEach((function(theme){var html='<div class="col-6 col-md-6 col-lg-6 col-xl-4 col-xxl-3 dynamic-content-item" data-wds-row="theme">';html+='<div class="card h-100">',theme.thumbnail?html+='<img src="'+theme.thumbnail+'" class="card-img-top" alt="'+theme.name+'">':html+='<svg class="bd-placeholder-img card-img-top" width="100%" height="250" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#868e96"></rect></svg>',html+='<div class="pt-1 p-3 pt-md-1 p-md-5">',html+='<div class="d-flex flex-column flex-grow-1 my-lg-2 my-2 pr-3">',html+='<span class="text-gray-700">'+theme.category_name+"</span>",html+='<span class="text-gray-700 fw-bold fs-4">'+theme.name+"</span>",html+="</div>",html+='<div class="d-flex flex-column flex-sm-row align-items-center justify-content-between" style="gap: 8px">',html+='<a href="'+theme.preview+'" target="_blank" class="btn btn-sm btn-primary justify-content-center w-100">'+WDS.inv.preview+"</a>",html+='<button type="button" class="btn btn-sm btn-success justify-content-center w-100 open-modal" data-bs-toggle="modal" data-bs-target="#form_modal" data-category-id="'+theme.category.id+'" data-taxonomy="'+theme.taxonomy+'" data-template="'+theme.ID+'" data-templateName="'+theme.name+'">'+WDS.inv.use+"</button>",html+="</div>",html+="</div>",html+="</div>",html+="</div>",dynamicContentContainer.append(html)}));else{var messageHtml='<div class="col-12 text-center"><div class="alert bg-light-danger border border-danger mb-0"><h4 class="text-danger mb-0">'+WDS.inv.theme_notfound+"</h4></div></div>";dynamicContentContainer.append(messageHtml)}$(".ajaxCardPlaceholder").addClass("d-none")},error:function(error){console.error("Error loading category data:",error)}})}function loadSubtheme(category_id,subcategory_id=""){subthemeList.empty(),$.ajax({url:WDS.ajax_url,type:"POST",dataType:"json",data:{name:"invitation_get_subtheme",action:"run_wds",__nonce:WDS.ajax_nonce,category:category_id,subcategory:subcategory_id},success:function(data){data?displaySubtheme(data):console.error("Error: Failed to retrieve subtheme data.")},error:function(error){console.error("Error loading subtheme data:",error)}})}function displaySubtheme(subthemes){subthemes.length>0&&($("#separator-subtheme").removeClass("d-none"),subthemes.forEach((function(category){var activeClass="all"==category.ex?" active":"",listItem=$('<li class="nav-item"><a href="#" class="nav-link btn btn-sm btn-color-muted btn-active btn-active-secondary fw-bold px-4 text-nowrap'+activeClass+'" data-subtheme-id="'+category.ID+'">'+category.name+"</span></a></li>");listItem.find("a").on("click",(function(e){e.preventDefault();var activeCategoryId=$("#category-list .nav-link.active").data("category-id"),activeSubcategoryId=$("#subcategory-list .nav-link.active").data("subcategory-id"),clickedSubtheme=$(this).data("subtheme-id");$(this).hasClass("active")||loadThemes(activeCategoryId,activeSubcategoryId,clickedSubtheme),listItem.siblings().find("a").removeClass("active"),$(this).addClass("active")})),subthemeList.append(listItem)})))}function handleBtnModal(e){document.body.addEventListener("click",(function(e){var categoryId,taxonomy,template,templateName;e.target.classList.contains("open-modal")&&loadModalContent(e.target.getAttribute("data-category-id"),e.target.getAttribute("data-taxonomy"),e.target.getAttribute("data-template"),e.target.getAttribute("data-templateName"))}))}function loadModalContent(categoryId,taxonomy,template,templateName){document.getElementById("category").value=categoryId,document.getElementById("taxonomy").value=taxonomy,document.getElementById("template").value=template,document.getElementById("templateName").value=templateName}function handleSubmit(){var form=document.querySelector("#invitation_form"),btn=document.querySelector("#invitation_submit"),fields={title:{validators:{notEmpty:{message:WDS.text.error.input_field}}},slug:{validators:{notEmpty:{message:WDS.text.error.input_field}}},price:{validators:{notEmpty:{message:WDS.text.error.input_field}}}},validator=initValidation(form,fields);btn.addEventListener("click",(function(e){e.preventDefault(),validator.validate().then((function(status){if("Valid"==status){disableButton(btn);var formData=new FormData(form);run_ajax("invitation_add",formData,(function(response){const message=response.data&&response.data.message?response.data.message:response.data;response.success?(form.reset(),run_ajax_success(message).then(result=>{if(result.isConfirmed){const redirectUrl=response.data.redirect;redirectUrl&&(location.href=redirectUrl)}})):run_ajax_error(message),resetButton(btn)}))}else run_ajax_error(WDS.text.error.input)}))}))}}function invitation_edit_page(){"dashboard/invitation/edit"!=page&&"dashboard/landingpage/edit"!=page||copy_clipboard(document.querySelector("#permalink_link_copy_btn"),document.querySelector("#permalink_link_input"))}function invitation_rsvp_page(){if("dashboard/invitation/rsvp"==page){var table=document.querySelector("#rsvp_table"),tableSearch=document.querySelector("#table_rsvp_search"),tableBtn=document.querySelector("#table_rsvp_button"),tableExport=document.querySelectorAll("#table_rsvp_menu [data-kt-export]"),title=table.getAttribute("data-title"),datatable=$(table).DataTable({info:!1,order:[],pageLength:10,responsive:!0});table_search_data(tableSearch,datatable),table_export_button(table,tableBtn,"RSVP "+title),table_export_data(tableExport)}}function client_page(){if("dashboard/client"==page){var table=document.querySelector("#client_table"),tableSearch=document.querySelector("#table_client_search"),tableBtn=document.querySelector("#table_client_button"),tableExport=document.querySelectorAll("#table_client_menu [data-kt-export]");table.querySelectorAll("tbody tr").forEach(row=>{const dateRow=row.querySelectorAll("td"),realDate=moment(dateRow[2].innerHTML,"DD MMM YYYY, LT").format();dateRow[2].setAttribute("data-order",realDate)});var datatable=$(table).DataTable({info:!1,order:[],pageLength:10});table_search_data(tableSearch,datatable),table_export_button(table,tableBtn,"Client "+WDS.blog_info),table_export_data(tableExport);var form=document.querySelector("#client_form"),btn=document.querySelector("#client_submit"),fields={name:{validators:{notEmpty:{message:WDS.text.error.input_field}}},email:{validators:{regexp:{regexp:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:WDS.text.error.email_invalid},notEmpty:{message:WDS.text.error.email_required}}},phone:{validators:{notEmpty:{message:WDS.text.error.phone_required}}},password:{validators:{notEmpty:{message:WDS.text.error.password_required}}},product:{validators:{notEmpty:{message:WDS.text.error.input_field}}},price:{validators:{notEmpty:{message:WDS.text.error.input_field}}}};if(form)var validator=initValidation(form,fields);btn&&btn.addEventListener("click",(function(e){e.preventDefault(),validator.validate().then((function(status){if("Valid"==status){disableButton(btn);var formData=new FormData(form);run_ajax("client_add",formData,(function(response){const message=response.data&&response.data.message?response.data.message:response.data;response.success?(form.reset(),run_ajax_success(message).then(result=>{if(result.isConfirmed){const redirectUrl=response.data.redirect;redirectUrl&&(location.href=redirectUrl)}})):run_ajax_error(message),resetButton(btn)}))}else run_ajax_error(WDS.text.error.input)}))}))}}function landing_page(){if("dashboard/landingpage"==page){document.querySelectorAll(".url_btn").forEach(btn=>{copy_clipboard(btn,btn.previousElementSibling)});var form=document.querySelector("#landing_form"),fields={name:{validators:{notEmpty:{message:WDS.text.error.input_field}}},logo:{validators:{notEmpty:{message:WDS.text.error.input_field}}},phone:{validators:{notEmpty:{message:WDS.text.error.input_field}}},price:{validators:{notEmpty:{message:WDS.text.error.input_field}}}},validator=initValidation(form,fields);$("#lg--host").length&&(checkSelection(),$("#lg--host").change((function(){checkSelection()}))),processForm("#landing_add_btn","landingpage_add"),processForm("#landing_update_btn","landingpage_update"),processForm("#landing_delete_btn","landingpage_delete")}function checkSelection(){var selectedValue=$("#lg--host").val();"subdomain"===selectedValue?($("#subdomain-row").show(),$("#domain-row").hide()):"domain"===selectedValue?($("#subdomain-row").hide(),$("#domain-row").show()):($("#subdomain-row").hide(),$("#domain-row").hide())}function processForm(buttonId,name){var button=document.querySelector(buttonId);button&&button.addEventListener("click",(function(e){e.preventDefault(),validator.validate().then((function(status){if("Valid"==status){disableButton(button);var formData=new FormData(form);if($("#lg--host").length)var value=$("#lg--host").val();else var value="domain";formData.append("value",value),run_ajax(name,formData,(function(response){const message=response.data&&response.data.message?response.data.message:response.data;response.success?run_ajax_success(message).then(result=>{result.isConfirmed&&(location.href=WDS.url.landingpage)}):run_ajax_error(message),resetButton(button)}))}else run_ajax_error(WDS.text.error.input)}))}))}}KTUtil.onDOMContentLoaded((function(){invitation_page(),invitation_create_page(),invitation_edit_page(),invitation_rsvp_page(),client_page(),landing_page()}))}(jQuery);