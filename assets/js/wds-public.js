!function($){"use strict";const page=WDS.page_name;function rsvp_page(){if("public/rsvp"==page){$(document).ready((function(){var password=WDS.public.rsvp_password,pass=$('input[name="rsvp_pass"]'),btn;$("#rsvp_btn").on("click",(function(e){e.preventDefault();var passValue=pass.val().trim();""!==passValue?passValue===password.replace("^_^","")?(showToast("success",WDS.public.text_rsvp3),setTimeout((function(){var currentUrl=new URL(window.location.href);currentUrl.searchParams.set("activate","success"),currentUrl.searchParams.set("pass",passValue),window.location.href=currentUrl.toString()}),1e3)):showToast("warning",WDS.public.text_rsvp2):showToast("error",WDS.public.text_rsvp1)}))}));var table=document.querySelector("#rsvp_table"),tableSearch=document.querySelector("#table_rsvp_search"),tableBtn=document.querySelector("#table_rsvp_button"),tableExport=document.querySelectorAll("#table_rsvp_menu [data-kt-export]"),title=table.getAttribute("data-title"),datatable=$(table).DataTable({info:!1,order:[],pageLength:10,responsive:!0});table_search_data(tableSearch,datatable),table_export_button(table,tableBtn,"RSVP "+title),table_export_data(tableExport)}}function share_page(){if("share"==page){var guestListName="guestList-"+WDSshare.cookie_id,restrict=WDSshare.is_restrict,guest=WDSshare.guest,message=WDSshare.message,invitation=WDSshare.invitation,text=WDSshare.text_default;if(restrict){var jsonData=JSON.stringify(getData(invitation,message,guest));localStorage.setItem(guestListName,jsonData)}else if(!localStorage.getItem(guestListName)){var jsonData=JSON.stringify(getData(invitation,text));localStorage.setItem(guestListName,jsonData)}var guestListData=localStorage.getItem(guestListName),guestList=JSON.parse(localStorage.getItem(guestListName));if(guestListData){if(guestList.guest){var guests=guestList.guest.replaceAll("\\'","'").replaceAll('\\"','"');$("#guest").val(guests)}guestList.message&&$("#message").val(guestList.message)}var form=document.querySelector("#share_form"),btn=document.querySelector("#share_submit"),fields={guest:{validators:{notEmpty:{message:WDS.text.error.input_field}}},message:{validators:{notEmpty:{message:WDS.text.error.input_field}}}},validator=initValidation(form,fields);$("#select-category").change((function(){$("#target-overlay").removeClass("d-none");var selected=$(this).val();$.ajax({url:WDS.ajax_url,type:"POST",data:{name:"share_get_message",action:"run_wds",__nonce:WDS.ajax_nonce,category:selected},success:function(response){$("#message").val(response.data),$("#target-overlay").addClass("d-none")}})})),btn.addEventListener("click",(function(e){e.preventDefault(),validator.validate().then((function(status){if("Valid"==status){disableButton(btn);var _guest=$("#guest").val(),_restrict=$("#restrict").is(":checked")?"yes":"no",_message=$("#message").val(),formData=new FormData(form);formData.append("post_id",WDSshare.post_id),formData.append("guest",_guest),formData.append("restrict",_restrict),formData.append("message",_message),run_ajax("share_process_data",formData,(function(response){const res_message=response.data&&response.data.message?response.data.message:response.data;if(response.success){var jsonData=JSON.stringify(getData(invitation,response.data.text,response.data.guest));localStorage.setItem(guestListName,jsonData),$("#share_table tbody").empty();var guestNames=response.data.guest.split("\n"),uniqueGuestNames;console.log(guestNames),Array.from(new Set(guestNames)).forEach((function(guestName){var trimmedGuestName=guestName.trim(),GuestNamefix=trimmedGuestName.replaceAll("\\'","'").replaceAll('\\"','"'),encodeGuestName=encodeURIComponent(GuestNamefix).replace(/%20/g,"+"),newLink=guestList.link+"?to="+encodeGuestName,postTitle=WDSshare.post_title,bride=WDSshare._bride,groom=WDSshare._groom,inviting=WDSshare._inviting,newMessage=response.data.text.replaceAll("["+WDSshare.var_name+"]",trimmedGuestName).replaceAll("[name]",trimmedGuestName).replaceAll("[nama]",trimmedGuestName).replaceAll("["+WDSshare.var_title+"]",postTitle).replaceAll("[invitation-title]",postTitle).replaceAll("[judul-undangan]",postTitle).replaceAll("["+WDSshare.var_link+"]",newLink).replaceAll("[invitation-link]",newLink).replaceAll("[link-undangan]",newLink).replaceAll("["+WDSshare.var_bride+"]",bride).replaceAll("[mempelai-wanita]",bride).replaceAll("["+WDSshare.var_groom+"]",groom).replaceAll("[mempelai-pria]",groom).replaceAll("["+WDSshare.var_inviting+"]",inviting).replaceAll("[yang-mengundang]",inviting).replaceAll("\\'","'"),whatsappMessage,urlWa,urlFb="https://www.facebook.com/sharer/sharer.php?u="+newLink+"&quote="+newLink,newRow="<tr><td>"+GuestNamefix+'</td><td class="text-end"><input type="hidden" class="guest_link" value="'+newLink+'"><input type="hidden" class="guest_message" value="'+newMessage+'"><a href="'+("https://api.whatsapp.com/send?phone=&text="+encodeURIComponent(newMessage))+'" target="_blank" class="btn btn-icon btn-success" style="height:2.2rem!important;width:2.2rem!important;"><i class="ki-solid ki-whatsapp fs-6"></i></a><button class="btn btn-icon btn-primary ms-2 btn-share" style="height:2.2rem!important;width:2.2rem!important;" data-message="'+newMessage+'"><i class="ki-solid ki-share fs-6"></i></button><button class="btn btn-icon btn-info ms-2 copy-link" style="height:2.2rem!important;width:2.2rem!important;" data-clipboard-target=".guest_link"><i class="ki-solid ki-fasten fs-6"></i></button><button class="btn btn-icon btn-secondary ms-2 copy-message" style="height:2.2rem!important;width:2.2rem!important;" data-clipboard-target=".guest_message"><i class="ki-solid ki-clipboard fs-6"></i></button></td> </tr>';$("#share_table tbody").append(newRow)})),setupDeleteListener(),run_ajax_success(res_message)}else run_ajax_error(res_message);resetButton(btn)}))}else run_ajax_error(WDS.text.error.input)}))}));var clipboardLink=new ClipboardJS(".copy-link",{text:function(trigger){var siblingInput;return trigger.parentElement.querySelector(".guest_link").value}});clipboardLink.on("success",(function(e){showToast("success",WDS.public.text_share1)})),clipboardLink.on("error",(function(e){showToast("error",WDS.public.text_share2,{timeOut:"3000"})}));var clipboardMessage=new ClipboardJS(".copy-message",{text:function(trigger){var siblingInput;return trigger.parentElement.querySelector(".guest_message").value}});clipboardMessage.on("success",(function(e){showToast("success",WDS.public.text_share3)})),clipboardMessage.on("error",(function(e){showToast("error",WDS.public.text_share4,{timeOut:"3000"})})),$(document).on("click",".btn-share",(async function(){const message=$(this).data("message");if(navigator.share)try{await navigator.share({title:WDSshare.post_title,text:message})}catch(err){console.error("Gagal share:",err)}else alert("Browser Anda tidak mendukung fitur Share. Silakan salin link secara manual.")}))}function getData(link="",message="",guest=""){return{link:link,message:message,guest:guest}}function handleDelete(e){function removeGuestAndReload(guestNameToRemove){if(guestNameToRemove){var currentGuestList=JSON.parse(localStorage.getItem(guestListName));if(currentGuestList&&currentGuestList.guest){var guestNames,updatedGuestNames=currentGuestList.guest.split("\n").filter((function(name){return name.trim()!==guestNameToRemove})),updatedGuestList={...currentGuestList,guest:updatedGuestNames.join("\n")};localStorage.setItem(guestListName,JSON.stringify(updatedGuestList)),location.reload()}}}$(".delete-guest").on("click",(function(){var guestNameToRemove;removeGuestAndReload($(this).data("guest-name"))}))}function setupDeleteListener(){$(".delete-guest").off("click"),handleDelete()}}function share_client_page(){"share/client"==page&&copy_clipboard(document.querySelector("#message_copy_btn"),document.querySelector("#message_copy_input"))}KTUtil.onDOMContentLoaded((function(){rsvp_page(),share_page(),share_client_page()}))}(jQuery);